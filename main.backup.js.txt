
const PB_URL = 'http://127.0.0.1:8090'; // Replace with your PocketBase server address

export async function initApp(PocketBase) {
    const pb = new PocketBase(PB_URL);

    // Check for authentication status (optional)
    if (pb.authStore.isValid) {
        console.log("User is authenticated:", pb.authStore.model.email);
    } else {
        console.log("User is not authenticated.");
    }

    try {
        await listPosts(pb);
    } catch (error) {
        console.error("Failed to list posts:", error);
        alert("Failed to list posts:");
    }    try {
        await listtest(pb);
    } catch (error) {
        console.error("Failed to list posts:", error);
        alert("Failed to list posts:");
    }
    //         try {
    //     console.log("Attempting to create post.");
        
    //     // Pass the actual 'pb' object as the first argument.
    //     // The values "New Task" and true are for 'title' and 'doneValue'.
    //     await createPost(pb, "testx", true, "try"); 
        
    //     await listPosts(pb); // Refresh the list
    //     console.log("Post created successfully!");
    // } catch (e) {
    //     console.error("Failed to create post. Check API rules.", e);
    // }

}


/**
 * Lists records from the 'posts' collection and updates the DOM.
 * @param {PocketBase} pb - The PocketBase client instance.
 */
async function listPosts(pb) {
    // 1. Fetch all records from the 'posts' collection
    const resultList = await pb.collection('posts').getList(1, 50, {
        sort: '-created', // Newest first
    });

    const postsList = document.getElementById('posts-list');
    postsList.innerHTML = ''; // Clear existing content

    if (resultList.items.length === 0) {
        postsList.innerHTML = '<li>No posts found. Create a "posts" collection in the Admin UI.</li>';
        return;
    }

    // 2. Iterate and create list items for each post
    resultList.items.forEach(post => {
        const listItem = document.createElement('li');
        // Assuming your 'posts' collection has a 'title' field
        listItem.textContent = `ID: ${post.id} - Title: ${post.name} (Created: ${new Date(post.created).toLocaleDateString()}), (up: ${new Date(post.updated).toLocaleDateString()})`;
        postsList.appendChild(listItem);
    });

    console.log("Fetched posts:", resultList.items);
}
async function listtest(pb) {
    // 1. Fetch all records from the 'posts' collection
    const resultList = await pb.collection('test1').getList(1, 50, {
        sort: '-created', // Newest first
    });

    const postsList = document.getElementById('test-list');
    postsList.innerHTML = ''; // Clear existing content

    if (resultList.items.length === 0) {
        postsList.innerHTML = '<li>No posts found. Create a "posts" collection in the Admin UI.</li>';
        return;
    }

    // 2. Iterate and create list items for each post
    resultList.items.forEach(post => {
        const listItem = document.createElement('li');
        // Assuming your 'posts' collection has a 'title' field
        listItem.textContent = `ID: ${post.id} - Title: ${post.name}, Choice: ${post.choice}, link: ${post.link}, link1: ${post.link1.done}, (Created: ${new Date(post.created).toLocaleDateString()}), (up: ${new Date(post.updated).toLocaleDateString()})`;
        postsList.appendChild(listItem);
    });

    console.log("Fetched posts:", resultList.items);
}

/**
 * Creates a new record in the 'posts' collection.
 * Assumes the collection has fields: 'name' (string) and 'done' (boolean).
 * * @param {PocketBase} pb - The PocketBase client instance.
 * @param {string} postName - The name/title of the post. (Passed as the 'title' argument to the function)
 * @param {boolean} isDone - The completion status. (Passed as the 'content' argument, but logically should be a boolean)
 */
async function createPost(pb, title, doneValue, testin) {

    const data = {
        // Ensure these field names ('title' and 'content') match your PocketBase collection fields
        "name": title,   
        "done": doneValue, 
        "test": testin, 
    };

    // The core API call to create the data
    const record = await pb.collection('posts').create(data);
    return record; 
}
